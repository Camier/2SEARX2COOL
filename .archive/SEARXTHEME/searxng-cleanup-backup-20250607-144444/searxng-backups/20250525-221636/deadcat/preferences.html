{% extends "deadcat/base.html" %}

{% block title %}{{ _('Preferences') }}{% endblock %}

{% block content %}
<div class="terminal-preferences">
    <div class="terminal-header">
        <div class="terminal-title">PREFERENCES.EXE - SYSTEM_CONFIG</div>
        <div class="terminal-controls">[■][□][×]</div>
    </div>
    
    <div class="terminal-body">
        <h1>&gt; SEARCH PREFERENCES</h1>
        
        <form method="post" action="{{ url_for('preferences') }}" id="search_form">
            <!-- Add CSRF token if available -->
            {% if csrf_token is defined %}
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            {% endif %}
            
            <!-- Language Settings -->
            <fieldset class="pref-section">
                <legend class="terminal-legend">[LANGUAGE_SETTINGS]</legend>
                
                <div class="pref-item">
                    <label for="locale">Search Language:</label>
                    <select name="locale" id="locale" class="terminal-select">
                        <option value="">{{ _('Default language') }}</option>
                        {% if locales %}
                        {% for locale_code, locale_name in locales.items() %}
                        <option value="{{ locale_code }}" {% if locale_code == current_locale %}selected{% endif %}>
                            {{ locale_name }}
                        </option>
                        {% endfor %}
                        {% endif %}
                    </select>
                </div>
            </fieldset>

            <!-- General Settings -->
            <fieldset class="pref-section">
                <legend class="terminal-legend">[GENERAL_SETTINGS]</legend>
                
                <!-- Autocomplete -->
                <div class="pref-item">
                    <label for="autocomplete">Autocomplete:</label>
                    <select name="autocomplete" id="autocomplete" class="terminal-select">
                        <option value="">{{ _('None') }}</option>
                        {% if autocomplete_backends %}
                        {% for backend in autocomplete_backends %}
                        <option value="{{ backend }}">{{ backend }}</option>
                        {% endfor %}
                        {% endif %}
                    </select>
                </div>
                
                <!-- Theme -->
                <div class="pref-item">
                    <label for="theme">Theme:</label>
                    <select name="theme" id="theme" class="terminal-select">
                        {% if themes %}
                        {% for theme_name in themes %}
                        <option value="{{ theme_name }}" {% if theme_name == 'deadcat' %}selected{% endif %}>
                            {{ theme_name }}
                        </option>
                        {% endfor %}
                        {% endif %}
                    </select>
                </div>
                
                <!-- Results per page -->
                <div class="pref-item">
                    <label for="results_per_page">Results per page:</label>
                    <select name="results_per_page" id="results_per_page" class="terminal-select">
                        <option value="10">10</option>
                        <option value="20">20</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
            </fieldset>
            
            <!-- Privacy Settings -->
            <fieldset class="pref-section">
                <legend class="terminal-legend">[PRIVACY_SETTINGS]</legend>
                
                <div class="pref-item">
                    <label for="safesearch">Safe Search:</label>
                    <select name="safesearch" id="safesearch" class="terminal-select">
                        <option value="0">{{ _('None') }}</option>
                        <option value="1">{{ _('Moderate') }}</option>
                        <option value="2">{{ _('Strict') }}</option>
                    </select>
                </div>
                
                <div class="pref-item">
                    <label for="method">HTTP Method:</label>
                    <select name="method" id="method" class="terminal-select">
                        <option value="POST">POST</option>
                        <option value="GET">GET</option>
                    </select>
                </div>
                
                <div class="pref-item">
                    <label>
                        <input type="checkbox" name="results_on_new_tab" value="1">
                        Open results in new tab
                    </label>
                </div>
                
                <div class="pref-item">
                    <label>
                        <input type="checkbox" name="image_proxy" value="1" {% if image_proxy %}checked{% endif %}>
                        Enable image proxy
                    </label>
                </div>
            </fieldset>
            
            <!-- Engine Settings - Simplified -->
            {% if engines_by_category %}
            <fieldset class="pref-section">
                <legend class="terminal-legend">[SEARCH_ENGINES]</legend>
                
                <div class="engines-preferences">
                    {% for categ_name, engines in engines_by_category.items() %}
                    {% if engines|length > 0 %}
                    <div class="engine-category-prefs">
                        <h3>&gt; {{ categ_name|upper }}</h3>
                        {% for engine in engines %}
                        <label class="engine-pref">
                            <input type="checkbox" 
                                   name="engine_{{ engine.name }}__{{ categ_name }}" 
                                   value="on"
                                   {% if disabled_engines is not defined or (engine.name, categ_name) not in disabled_engines %}checked{% endif %}>
                            {{ engine.name }}
                        </label>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </fieldset>
            {% endif %}
            
            <!-- Plugins -->
            {% if plugins_storage is defined and plugins_storage %}
            <fieldset class="pref-section">
                <legend class="terminal-legend">[PLUGINS]</legend>
                <div class="plugins-list">
                    {% for plugin in plugins_storage %}
                    {% if plugin.preference_section is defined %}
                    <label class="plugin-pref">
                        <input type="checkbox" 
                               name="plugin_{{ plugin.id }}" 
                               value="on"
                               {% if allowed_plugins is defined and plugin.id in allowed_plugins %}checked{% endif %}>
                        {{ plugin.name }}
                    </label>
                    {% endif %}
                    {% endfor %}
                </div>
            </fieldset>
            {% endif %}
            
            <div class="pref-actions">
                <button type="submit" name="save" value="1" class="terminal-button save-button">&gt; SAVE</button>
                <a href="{{ url_for('index') }}" class="terminal-button cancel-button">&gt; CANCEL</a>
            </div>
        </form>
    </div>
</div>

<style>
/* Terminal theme for preferences */
.terminal-preferences {
    background: #000;
    border: 1px solid #0f0;
    margin: 20px auto;
    max-width: 900px;
}

.terminal-header {
    background: #0f0;
    color: #000;
    padding: 5px 10px;
    display: flex;
    justify-content: space-between;
    font-family: monospace;
}

.terminal-body {
    padding: 20px;
    color: #0f0;
    font-family: monospace;
}

.pref-section {
    margin: 20px 0;
    padding: 15px;
    border: 1px solid #0f0;
    background: rgba(0, 255, 0, 0.02);
}

.pref-section legend {
    color: #ff0;
    padding: 0 10px;
    font-weight: bold;
}

.pref-item {
    margin: 10px 0;
    padding: 5px;
}

.pref-item label {
    display: inline-block;
    min-width: 150px;
}

.terminal-select {
    background: #000;
    color: #0f0;
    border: 1px solid #0f0;
    padding: 5px 10px;
    font-family: monospace;
    min-width: 200px;
}

.terminal-select:focus {
    outline: none;
    box-shadow: 0 0 5px #0f0;
}

.engines-preferences {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 15px;
}

.engine-category-prefs h3 {
    color: #ff0;
    margin-bottom: 10px;
    font-size: 14px;
}

.engine-pref, .plugin-pref {
    display: block;
    margin: 5px 0;
}

.pref-actions {
    margin-top: 30px;
    display: flex;
    gap: 15px;
    justify-content: center;
}

.terminal-button {
    padding: 10px 20px;
    border: 1px solid #0f0;
    background: #000;
    color: #0f0;
    font-family: monospace;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    transition: all 0.3s;
}

.save-button:hover {
    background: #0f0;
    color: #000;
    box-shadow: 0 0 10px #0f0;
}

.cancel-button {
    border-color: #f00;
    color: #f00;
}

.cancel-button:hover {
    background: #f00;
    color: #fff;
}

input[type="checkbox"] {
    margin-right: 5px;
}

h1 {
    color: #0f0;
    margin-bottom: 20px;
    font-size: 24px;
}

.plugins-list {
    display: flex;
    flex-direction: column;
    gap: 5px;
}
</style>
{% endblock %}
