{% extends "deadcat/base.html" %}
{% block title %}{{ q|e }} - {% endblock %}
{% block content %}
<main id="main_results" role="main">
    <div class="terminal-window">
        <div class="terminal-header">
            <span>SEARCH_RESULTS.EXE - "{{ q|e }}"</span>
            <span>[■][□][×]</span>
        </div>
        <div class="terminal-body">
            <!-- Search form -->
            <form method="{{ method|default('POST') }}" action="{{ url_for('search') }}">
                <div class="search-prompt" style="display: flex; align-items: center; margin-bottom: 15px;">
                    <span style="color: #ffb000; margin-right: 10px;">search@alfredisgone:~$</span>
                    <input type="search" name="q" value="{{ q }}" autofocus
                           style="background: #000; border: none; color: #00ff00; font-family: monospace; flex: 1; padding: 5px;">
                    <button type="submit" style="margin-left: 10px; padding: 5px 15px; background: #000; border: 1px solid #00ff00; color: #00ff00; cursor: pointer; font-family: monospace;">
                        &gt; SEARCH
                    </button>
                </div>
                
                <!-- Categories with text directly in template -->
                {% if categories %}
                <div class="categories" style="margin: 15px 0; padding: 10px; border: 1px solid #00ff00;">
                    <div style="color: #00ff00; font-weight: bold; margin-bottom: 10px;">CATEGORIES:</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 20px;">
                        {% for category in categories %}
                        <label style="color: #00ff00 !important; cursor: pointer; display: inline-flex; align-items: center; font-family: monospace;">
                            <input type="checkbox" name="category_{{ category.id }}" 
                                   {% if selected_categories and category.id in selected_categories %}checked{% endif %}
                                   style="margin-right: 8px; cursor: pointer; width: 16px; height: 16px;">
                            {% if category.id == 'general' %}GENERAL{% elif category.id == 'images' %}IMAGES{% elif category.id == 'videos' %}VIDEOS{% elif category.id == 'news' %}NEWS{% elif category.id == 'map' %}MAP{% elif category.id == 'music' %}MUSIC{% elif category.id == 'it' %}IT{% elif category.id == 'science' %}SCIENCE{% elif category.id == 'files' %}FILES{% elif category.id == 'social_media' %}SOCIAL MEDIA{% else %}{{ category.id|upper }}{% endif %}
                        </label>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </form>
            
            <!-- Results info -->
            <div class="search-info" style="color: #00ff00; margin: 15px 0; font-size: 12px; font-family: monospace;">
                <span style="color: #ffb000;">[RESULTS]</span> {{ number_of_results|default(results|length if results else 0) }} • 
                <span style="color: #ffb000;">[TIME]</span> {{ search_time|default('0.00') }}s
            </div>
            
            <!-- Results list with metadata -->
            <div id="results">
                {% if results %}
                    {% for result in results %}
                    <article class="result" style="margin: 20px 0; padding: 15px; border: 1px solid #333; font-family: monospace;">
                        <h4 style="margin: 0 0 10px 0;">
                            <a href="{{ result.url }}" 
                               {% if results_on_new_tab %}target="_blank" rel="noopener noreferrer"{% endif %}
                               style="color: #00ff00; text-decoration: none; font-size: 16px;">
                                &gt; &gt; &gt; {{ result.title|safe }}
                            </a>
                        </h4>
                        
                        <div style="margin: 5px 0; font-size: 12px; color: #888;">
                            <span style="color: #ffb000;">{{ result.pretty_url }}</span>
                            {% if result.engine %}
                            <span style="color: #00ffff; margin-left: 15px;">[ENGINE: {{ result.engine|upper }}]</span>
                            {% endif %}
                            {% if result.category %}
                            <span style="color: #ff00ff; margin-left: 15px;">[{{ result.category|upper }}]</span>
                            {% endif %}
                            {% if result.publishedDate %}
                            <span style="color: #ffff00; margin-left: 15px;">[{{ result.publishedDate }}]</span>
                            {% endif %}
                        </div>
                        
                        {% if result.content %}
                        <p style="color: #00ff00; margin: 10px 0; line-height: 1.5; font-size: 14px;">
                            {{ result.content|safe }}
                        </p>
                        {% endif %}
                        
                        <div style="margin-top: 10px; font-size: 11px; color: #666;">
                            {% if result.score %}
                            <span>[SCORE: {{ result.score }}]</span>
                            {% endif %}
                            {% if result.template %}
                            <span style="margin-left: 10px;">[TEMPLATE: {{ result.template }}]</span>
                            {% endif %}
                        </div>
                    </article>
                    {% endfor %}
                {% else %}
                    <div class="no-results" style="text-align: center; margin: 50px 0;">
                        <p style="color: #ff0040; font-size: 18px;">No results found for "{{ q|e }}"</p>
                        <pre style="color: #00ff00; margin: 20px auto;">
    |\___/|
    | x.x |  Alfred couldn't find anything...
    |_____|
                        </pre>
                    </div>
                {% endif %}
            </div>
            
            <!-- Pagination -->
            {% if (pageno|default(1) > 1) or (results and results|length >= 10) %}
            <div class="pagination" style="text-align: center; margin: 30px 0;">
                {% if pageno|default(1) > 1 %}
                <form method="{{ method|default('POST') }}" action="{{ url_for('search') }}" style="display: inline;">
                    <input type="hidden" name="q" value="{{ q }}">
                    <input type="hidden" name="pageno" value="{{ (pageno|default(1)) - 1 }}">
                    {% if selected_categories %}
                        {% for cat_id in selected_categories %}
                        <input type="hidden" name="category_{{ cat_id }}" value="on">
                        {% endfor %}
                    {% endif %}
                    <button type="submit" style="padding: 10px 20px; background: #000; border: 1px solid #00ff00; color: #00ff00; font-family: monospace;">
                        &lt; Previous
                    </button>
                </form>
                {% endif %}
                
                <span style="margin: 0 20px; color: #ffb000; font-family: monospace;">Page {{ pageno|default(1) }}</span>
                
                {% if results and results|length >= 10 %}
                <form method="{{ method|default('POST') }}" action="{{ url_for('search') }}" style="display: inline;">
                    <input type="hidden" name="q" value="{{ q }}">
                    <input type="hidden" name="pageno" value="{{ (pageno|default(1)) + 1 }}">
                    {% if selected_categories %}
                        {% for cat_id in selected_categories %}
                        <input type="hidden" name="category_{{ cat_id }}" value="on">
                        {% endfor %}
                    {% endif %}
                    <button type="submit" style="padding: 10px 20px; background: #000; border: 1px solid #00ff00; color: #00ff00; font-family: monospace;">
                        Next &gt;
                    </button>
                </form>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</main>
{% endblock %}
